# Data Generation Scripts

This directory contains **all essential scripts** needed to regenerate TypeScript data files from game source files.

## Structure

```
scripts/data/
├── README.md                              # This file
├── generate-from-work.mjs                 # Master pipeline orchestrator ⭐
├── extract-from-w3x.mjs                   # Step 1: Extract raw data from war3map files
├── extract-metadata.mjs                   # Step 2: Extract metadata (units, buildings, recipes)
├── convert-extracted-to-typescript.mjs    # Step 3: Convert JSON to TypeScript files
└── regenerate-iconmap.mjs                 # Step 4: Generate icon mapping
```

## Quick Start

Run the master script to generate all TypeScript data files:

```bash
node scripts/data/generate-from-work.mjs
```

This single command will:
1. Extract raw game data from `external/Work/` war3map files
2. Extract metadata (units, buildings, recipes)
3. Convert everything to TypeScript format
4. Generate icon mapping

## Pipeline Scripts

These scripts are **automatically called** by `generate-from-work.mjs` in this order:

### 1. `extract-from-w3x.mjs`
- Extracts raw game data from `external/Work/` war3map files
- Input: `external/Work/war3map.{w3t,w3a,w3u,w3b}`
- Output: `data/island_troll_tribes/extracted_from_w3x/*.json`

### 2. `extract-metadata.mjs`
- Extracts metadata (units, buildings, recipes) from extracted data
- Input: `data/island_troll_tribes/extracted_from_w3x/*.json`
- Output: `data/island_troll_tribes/{units,buildings,recipes,abilities}.json`

### 3. `convert-extracted-to-typescript.mjs`
- Converts JSON files to TypeScript data files
- Uses `category-mappings.json` for categorization (manually curated)
- Input: JSON files from previous steps
- Output: `src/features/modules/guides/data/{items,abilities,units}/*.ts`

### 4. `regenerate-iconmap.mjs`
- Generates icon mapping from icon files
- Input: `public/icons/itt/*.png` + generated data files
- Output: `src/features/modules/guides/data/iconMap.ts`

## Manual Pipeline Execution

If you need to run individual pipeline steps manually:

```bash
# Step 1: Extract from war3map files
node scripts/data/extract-from-w3x.mjs

# Step 2: Extract metadata
node scripts/data/extract-metadata.mjs

# Step 3: Convert to TypeScript
node scripts/data/convert-extracted-to-typescript.mjs

# Step 4: Regenerate icon map
node scripts/data/regenerate-iconmap.mjs
```

## Dependencies

### Required Files

- `external/Work/` directory with war3map files:
  - `war3map.w3t` (items)
  - `war3map.w3a` (abilities)
  - `war3map.w3u` (units)
  - `war3map.w3b` (buildings)

### Required Data Files

- `data/island_troll_tribes/category-mappings.json` - Manually curated category mappings
- `data/island_troll_tribes/recipes.json` - Recipe data (optional, generated if missing)
- `data/island_troll_tribes/buildings.json` - Building metadata (generated by pipeline)
- `data/island_troll_tribes/units.json` - Unit metadata (generated by pipeline)
- `data/island_troll_tribes/abilities.json` - Ability metadata (optional, generated if missing)

## Notes

- **Only essential scripts remain** - All utility, cleanup, migration, and validation scripts have been removed
- The master script automatically orchestrates the complete pipeline - no need to run individual scripts
- Category mappings are manually curated in `category-mappings.json` and not regenerated by the pipeline
